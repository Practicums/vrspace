name: PULL

on:
  # Trigger the workflow on push or pull request,
  # but only for the main branch
  push:
    branches:
      - unit-test
      - lint-test

jobs:
  createPullRequest:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v1
        with:
          node-version: 12

      # ESLint and Prettier must be in `package.json`
      - name: Install Node.js dependencies
        run: npm ci
      
      - id: files
        uses: jitterbit/get-changed-files@v1
      - run: |
            echo "hello" > report.txt;
            for changed_file in ${{ steps.files.outputs.all }}; 
            do
            if [[ $changed_file == *.js ]]
            then
              echo $changed_file
              npx eslint $changed_file >> report.txt 2>/dev/null

            fi
            done

      - name: Create Pull Request
        id: cpr
        uses: peter-evans/create-pull-request@v4
        with:
          token: ${{ secrets.PAT }}
          commit-message: Update report
          committer: GitHub <noreply@github.com>
          author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
          signoff: false
          branch: example-patches
          delete-branch: true
          title: '[Example] Update report'
          body: |
            Update report
            - Updated with *today's* date
            - Auto-generated by [create-pull-request][1]

            [1]: https://github.com/peter-evans/create-pull-request
          labels: |
            report
            automated pr
